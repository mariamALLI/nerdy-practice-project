var app=function(){"use strict";function t(){}function e(t,e){for(const n in e)t[n]=e[n];return t}function n(t){return t()}function r(){return Object.create(null)}function o(t){t.forEach(n)}function c(t){return"function"==typeof t}function s(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function l(t,e){t.appendChild(e)}function i(t,e,n){t.insertBefore(e,n||null)}function a(t){t.parentNode.removeChild(t)}function u(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function d(t){return document.createElement(t)}function f(t){return document.createTextNode(t)}function p(){return f(" ")}function h(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function m(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function v(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}let g;function $(t){g=t}function y(t){(function(){if(!g)throw new Error("Function called outside component initialization");return g})().$$.on_mount.push(t)}const k=[],w=[],x=[],b=[],_=Promise.resolve();let j=!1;function C(t){x.push(t)}let E=!1;const I=new Set;function M(){if(!E){E=!0;do{for(let t=0;t<k.length;t+=1){const e=k[t];$(e),F(e.$$)}for($(null),k.length=0;w.length;)w.pop()();for(let t=0;t<x.length;t+=1){const e=x[t];I.has(e)||(I.add(e),e())}x.length=0}while(k.length);for(;b.length;)b.pop()();j=!1,E=!1,I.clear()}}function F(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(C)}}const U=new Set;let A;function T(){A={r:0,c:[],p:A}}function N(){A.r||o(A.c),A=A.p}function S(t,e){t&&t.i&&(U.delete(t),t.i(e))}function B(t,e,n,r){if(t&&t.o){if(U.has(t))return;U.add(t),A.c.push((()=>{U.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}}function P(t,e){const n={},r={},o={$$scope:1};let c=t.length;for(;c--;){const s=t[c],l=e[c];if(l){for(const t in s)t in l||(r[t]=1);for(const t in l)o[t]||(n[t]=l[t],o[t]=1);t[c]=l}else for(const t in s)o[t]=1}for(const t in r)t in n||(n[t]=void 0);return n}function L(t){return"object"==typeof t&&null!==t?t:{}}function O(t){t&&t.c()}function q(t,e,r){const{fragment:s,on_mount:l,on_destroy:i,after_update:a}=t.$$;s&&s.m(e,r),C((()=>{const e=l.map(n).filter(c);i?i.push(...e):o(e),t.$$.on_mount=[]})),a.forEach(C)}function z(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function G(t,e){-1===t.$$.dirty[0]&&(k.push(t),j||(j=!0,_.then(M)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function H(e,n,c,s,l,i,u=[-1]){const d=g;$(e);const f=n.props||{},p=e.$$={fragment:null,ctx:null,props:i,update:t,not_equal:l,bound:r(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(d?d.$$.context:[]),callbacks:r(),dirty:u,skip_bound:!1};let h=!1;if(p.ctx=c?c(e,f,((t,n,...r)=>{const o=r.length?r[0]:n;return p.ctx&&l(p.ctx[t],p.ctx[t]=o)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](o),h&&G(e,t)),n})):[],p.update(),h=!0,o(p.before_update),p.fragment=!!s&&s(p.ctx),n.target){if(n.hydrate){const t=function(t){return Array.from(t.childNodes)}(n.target);p.fragment&&p.fragment.l(t),t.forEach(a)}else p.fragment&&p.fragment.c();n.intro&&S(e.$$.fragment),q(e,n.target,n.anchor),M()}$(d)}class D{$destroy(){z(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function J(t){let e,n,r;return{c(){e=d("div"),n=d("img"),m(n,"alt","avatar"),n.src!==(r=t[0])&&m(n,"src",r),m(n,"class","svelte-15oev96"),m(e,"class","avatar has-story svelte-15oev96")},m(t,r){i(t,e,r),l(e,n)},p(t,e){1&e&&n.src!==(r=t[0])&&m(n,"src",r)},d(t){t&&a(e)}}}function K(t){let e,n,r;return{c(){e=d("div"),n=d("img"),m(n,"alt","avatar"),n.src!==(r=t[0])&&m(n,"src",r),m(n,"class","svelte-15oev96"),m(e,"class","avatar has-story svelte-15oev96"),m(e,"id","friend")},m(t,r){i(t,e,r),l(e,n)},p(t,e){1&e&&n.src!==(r=t[0])&&m(n,"src",r)},d(t){t&&a(e)}}}function Q(t){let e,n,r;return{c(){e=d("img"),m(e,"alt",n=`${t[2]}-flair`),e.src!==(r=flairMap[t[2]])&&m(e,"src",r),m(e,"class","svelte-15oev96")},m(t,n){i(t,e,n)},p(t,o){4&o&&n!==(n=`${t[2]}-flair`)&&m(e,"alt",n),4&o&&e.src!==(r=flairMap[t[2]])&&m(e,"src",r)},d(t){t&&a(e)}}}function R(e){let n,r,o,s,u,g,$,y,k,w=e[1].slice(0,11)+"";function x(t,e){return t[4]?K:J}let b=x(e),_=b(e),j=e[2]&&e[2]in flairMap&&Q(e);return{c(){n=d("div"),_.c(),r=p(),o=d("div"),j&&j.c(),s=p(),u=d("div"),g=d("div"),$=f(w),m(o,"class","flair svelte-15oev96"),m(g,"class","svelte-15oev96"),m(u,"class","name-container svelte-15oev96"),m(n,"class","unit svelte-15oev96")},m(t,a){i(t,n,a),_.m(n,null),l(n,r),l(n,o),j&&j.m(o,null),l(n,s),l(n,u),l(u,g),l(g,$),y||(k=h(n,"click",(function(){c(e[3])&&e[3].apply(this,arguments)})),y=!0)},p(t,[c]){b===(b=x(e=t))&&_?_.p(e,c):(_.d(1),_=b(e),_&&(_.c(),_.m(n,r))),e[2]&&e[2]in flairMap?j?j.p(e,c):(j=Q(e),j.c(),j.m(o,null)):j&&(j.d(1),j=null),2&c&&w!==(w=e[1].slice(0,11)+"")&&v($,w)},i:t,o:t,d(t){t&&a(n),_.d(),j&&j.d(),y=!1,k()}}}function V(t,e,n){let{creatorAvatarUrl:r}=e,{creatorUsername:o}=e,{flair:c}=e,{onClick:s}=e,{creatorIsFriend:l}=e;return t.$$set=t=>{"creatorAvatarUrl"in t&&n(0,r=t.creatorAvatarUrl),"creatorUsername"in t&&n(1,o=t.creatorUsername),"flair"in t&&n(2,c=t.flair),"onClick"in t&&n(3,s=t.onClick),"creatorIsFriend"in t&&n(4,l=t.creatorIsFriend)},[r,o,c,s,l]}class W extends D{constructor(t){super(),H(this,t,V,R,s,{creatorAvatarUrl:0,creatorUsername:1,flair:2,onClick:3,creatorIsFriend:4})}}function X(t,e,n){const r=t.slice();return r[18]=e[n],r}function Y(t,e,n){const r=t.slice();return r[18]=e[n],r}function Z(t){let e,n,r,o,c,s,l,h=t[11]&&t[5].length>0&&nt(t),v=t[4],g=[];for(let e=0;e<v.length;e+=1)g[e]=lt(X(t,v,e));const $=t=>B(g[t],1,1,(()=>{g[t]=null}));let y=t[6]&&it(t);return{c(){h&&h.c(),e=p(),n=d("p"),n.textContent="Explore",r=p(),o=d("div");for(let t=0;t<g.length;t+=1)g[t].c();c=p(),y&&y.c(),s=f(""),m(n,"class","caption svelte-7jk0dw"),m(o,"class","story-grid svelte-7jk0dw")},m(t,a){h&&h.m(t,a),i(t,e,a),i(t,n,a),i(t,r,a),i(t,o,a);for(let t=0;t<g.length;t+=1)g[t].m(o,null);i(t,c,a),y&&y.m(t,a),i(t,s,a),l=!0},p(t,n){if(t[11]&&t[5].length>0?h?(h.p(t,n),32&n&&S(h,1)):(h=nt(t),h.c(),S(h,1),h.m(e.parentNode,e)):h&&(T(),B(h,1,1,(()=>{h=null})),N()),16&n){let e;for(v=t[4],e=0;e<v.length;e+=1){const r=X(t,v,e);g[e]?(g[e].p(r,n),S(g[e],1)):(g[e]=lt(r),g[e].c(),S(g[e],1),g[e].m(o,null))}for(T(),e=v.length;e<g.length;e+=1)$(e);N()}t[6]?y?y.p(t,n):(y=it(t),y.c(),y.m(s.parentNode,s)):y&&(y.d(1),y=null)},i(t){if(!l){S(h);for(let t=0;t<v.length;t+=1)S(g[t]);l=!0}},o(t){B(h),g=g.filter(Boolean);for(let t=0;t<g.length;t+=1)B(g[t]);l=!1},d(t){h&&h.d(t),t&&a(e),t&&a(n),t&&a(r),t&&a(o),u(g,t),t&&a(c),y&&y.d(t),t&&a(s)}}}function tt(e){let n;return{c(){n=d("p"),n.textContent="loading stories..."},m(t,e){i(t,n,e)},p:t,i:t,o:t,d(t){t&&a(n)}}}function et(e){let n,r,o,c=e[8].message+"";return{c(){n=d("p"),r=f("An error has occured: "),o=f(c)},m(t,e){i(t,n,e),l(n,r),l(n,o)},p(t,e){256&e&&c!==(c=t[8].message+"")&&v(o,c)},i:t,o:t,d(t){t&&a(n)}}}function nt(t){let e,n,r,o,c,s,l,f=t[5],h=[];for(let e=0;e<f.length;e+=1)h[e]=rt(Y(t,f,e));const v=t=>B(h[t],1,1,(()=>{h[t]=null}));let g=t[7]&&ot(t);return{c(){e=d("p"),e.textContent="GitHub Friends",n=p(),r=d("div");for(let t=0;t<h.length;t+=1)h[t].c();var t,l,i;o=p(),g&&g.c(),c=p(),s=d("hr"),m(e,"class","caption svelte-7jk0dw"),t="margin-top",l="-2px",e.style.setProperty(t,l,i?"important":""),m(r,"class","story-grid svelte-7jk0dw")},m(t,a){i(t,e,a),i(t,n,a),i(t,r,a);for(let t=0;t<h.length;t+=1)h[t].m(r,null);i(t,o,a),g&&g.m(t,a),i(t,c,a),i(t,s,a),l=!0},p(t,e){if(32&e){let n;for(f=t[5],n=0;n<f.length;n+=1){const o=Y(t,f,n);h[n]?(h[n].p(o,e),S(h[n],1)):(h[n]=rt(o),h[n].c(),S(h[n],1),h[n].m(r,null))}for(T(),n=f.length;n<h.length;n+=1)v(n);N()}t[7]?g?g.p(t,e):(g=ot(t),g.c(),g.m(c.parentNode,c)):g&&(g.d(1),g=null)},i(t){if(!l){for(let t=0;t<f.length;t+=1)S(h[t]);l=!0}},o(t){h=h.filter(Boolean);for(let t=0;t<h.length;t+=1)B(h[t]);l=!1},d(t){t&&a(e),t&&a(n),t&&a(r),u(h,t),t&&a(o),g&&g.d(t),t&&a(c),t&&a(s)}}}function rt(t){let n,r;function o(){return t[12](t[18])}const c=[{onClick:o},t[18]];let s={};for(let t=0;t<c.length;t+=1)s=e(s,c[t]);return n=new W({props:s}),{c(){O(n.$$.fragment)},m(t,e){q(n,t,e),r=!0},p(e,r){t=e;const s=32&r?P(c,[{onClick:o},32&r&&L(t[18])]):{};n.$set(s)},i(t){r||(S(n.$$.fragment,t),r=!0)},o(t){B(n.$$.fragment,t),r=!1},d(t){z(n,t)}}}function ot(t){let e,n,r,o;function c(t,e){return"more"===t[1]?st:ct}let s=c(t),l=s(t);return{c(){e=d("button"),l.c(),e.disabled=n="ready"!==t[1],m(e,"class","svelte-7jk0dw")},m(n,c){i(n,e,c),l.m(e,null),r||(o=h(e,"click",t[13]),r=!0)},p(t,r){s!==(s=c(t))&&(l.d(1),l=s(t),l&&(l.c(),l.m(e,null))),2&r&&n!==(n="ready"!==t[1])&&(e.disabled=n)},d(t){t&&a(e),l.d(),r=!1,o()}}}function ct(t){let e;return{c(){e=f("load more")},m(t,n){i(t,e,n)},d(t){t&&a(e)}}}function st(t){let e,n,r,o;return{c(){e=f("loading"),n=d("span"),n.textContent=".",r=d("span"),r.textContent=".",o=d("span"),o.textContent=".",m(n,"class","one svelte-7jk0dw"),m(r,"class","two svelte-7jk0dw"),m(o,"class","three svelte-7jk0dw")},m(t,c){i(t,e,c),i(t,n,c),i(t,r,c),i(t,o,c)},d(t){t&&a(e),t&&a(n),t&&a(r),t&&a(o)}}}function lt(t){let n,r;function o(){return t[14](t[18])}const c=[{onClick:o},t[18]];let s={};for(let t=0;t<c.length;t+=1)s=e(s,c[t]);return n=new W({props:s}),{c(){O(n.$$.fragment)},m(t,e){q(n,t,e),r=!0},p(e,r){t=e;const s=16&r?P(c,[{onClick:o},16&r&&L(t[18])]):{};n.$set(s)},i(t){r||(S(n.$$.fragment,t),r=!0)},o(t){B(n.$$.fragment,t),r=!1},d(t){z(n,t)}}}function it(t){let e,n,r,o;function c(t,e){return"more"===t[0]?ut:at}let s=c(t),l=s(t);return{c(){e=d("button"),l.c(),e.disabled=n="ready"!==t[0],m(e,"class","svelte-7jk0dw")},m(n,c){i(n,e,c),l.m(e,null),r||(o=h(e,"click",t[15]),r=!0)},p(t,r){s!==(s=c(t))&&(l.d(1),l=s(t),l&&(l.c(),l.m(e,null))),1&r&&n!==(n="ready"!==t[0])&&(e.disabled=n)},d(t){t&&a(e),l.d(),r=!1,o()}}}function at(t){let e;return{c(){e=f("load more")},m(t,n){i(t,e,n)},d(t){t&&a(e)}}}function ut(t){let e,n,r,o;return{c(){e=f("loading"),n=d("span"),n.textContent=".",r=d("span"),r.textContent=".",o=d("span"),o.textContent=".",m(n,"class","one svelte-7jk0dw"),m(r,"class","two svelte-7jk0dw"),m(o,"class","three svelte-7jk0dw")},m(t,c){i(t,e,c),i(t,n,c),i(t,r,c),i(t,o,c)},d(t){t&&a(e),t&&a(n),t&&a(r),t&&a(o)}}}function dt(t){let e,n,r,o;const c=[et,tt,Z],s=[];function l(t,e){return t[8]?0:"initial"===t[0]||"refetch"===t[0]?1:2}return n=l(t),r=s[n]=c[n](t),{c(){e=d("main"),r.c()},m(t,r){i(t,e,r),s[n].m(e,null),o=!0},p(t,[o]){let i=n;n=l(t),n===i?s[n].p(t,o):(T(),B(s[i],1,1,(()=>{s[i]=null})),N(),r=s[n],r?r.p(t,o):(r=s[n]=c[n](t),r.c()),S(r,1),r.m(e,null))},i(t){o||(S(r),o=!0)},o(t){B(r),o=!1},d(t){t&&a(e),s[n].d()}}}function ft(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,c){function s(t){try{i(r.next(t))}catch(t){c(t)}}function l(t){try{i(r.throw(t))}catch(t){c(t)}}function i(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,l)}i((r=r.apply(t,e||[])).next())}))};let o="initial",c="initial",s=0,l=0,i=[];const a=()=>r(void 0,void 0,void 0,(function*(){try{const t=yield(async t=>{try{const e=await fetch(apiBaseUrl+t,{headers:{"access-token":accessToken,"refresh-token":refreshToken}});if(200!==e.status)throw new Error(await e.text());const n=e.headers.get("access-token"),r=e.headers.get("refresh-token");return n&&r&&(accessToken=n,refreshToken=r,tsvscode.postMessage({type:"tokens",accessToken:n,refreshToken:r})),await e.json()}catch(t){throw tsvscode.postMessage({type:"onError",value:t.message}),t}})("/text-stories/friends/hot"+(l?`/${l}/${i.join(",")}`:""));i=t.friendIds,n(7,h=t.hasMore);const e=new Set,r=[];"refetch"!==c&&f.forEach((t=>{t.creatorIsFriend=!0,r.push(t),e.add(t.id)}));for(const n of t.stories)e.has(n.id)||(n.creatorIsFriend=!0,r.push(n),e.add(n.id));n(5,f=r)}catch(t){n(8,m=t)}n(1,c="ready")})),u=()=>r(void 0,void 0,void 0,(function*(){try{const t=yield fetch(`${apiBaseUrl}/text-stories/hot`+(s?`/${s}`:"")),e=yield t.json(),r=new Set,c=[];"refetch"!==o&&d.forEach((t=>{i.includes(t.creatorId)&&(t.creatorIsFriend=!0),c.push(t),r.add(t.id)}));for(const t of e.stories)r.has(t.id)||(i.includes(t.creatorId)&&(t.creatorIsFriend=!0),c.push(t),r.add(t.id));n(4,d=c),n(6,p=e.hasMore)}catch(t){n(8,m=t)}n(0,o="ready")}));let d=[],f=[],p=!1,h=!1,m=null,v=""!==accessToken;y((()=>r(void 0,void 0,void 0,(function*(){v&&(yield a()),yield u()})))),window.addEventListener("message",(t=>{const e=t.data;switch(e.command){case"new-story":d.every((t=>t.id!==e.story.id))&&n(4,d=[e.story,...d]);break;case"refresh":"ready"===o&&(n(2,s=0),n(3,l=0),n(1,c="refetch"),n(0,o="refetch"),v&&a(),u())}}));return[o,c,s,l,d,f,p,h,m,a,u,v,t=>{tsvscode.postMessage({type:"onStoryPress",value:t})},()=>{n(1,c="more"),n(3,l++,l),v&&a()},t=>{tsvscode.postMessage({type:"onStoryPress",value:t})},()=>{n(0,o="more"),n(2,s++,s),u()}]}return new class extends D{constructor(t){super(),H(this,t,ft,dt,s,{})}}({target:document.body})}();
//# sourceMappingURL=sidebar.js.map
